# AFI-Core Repository Audit

**Date:** 2025-11-16  
**Branch:** `migration/multi-repo-reorg`  
**Commit:** `59f264996752251a16788fce2715c2cec7252970`

---

## High-Level Purpose

**AFI-Core** is the **runtime and validation layer** for the AFI Protocol. It provides:
- Signal validation logic (Proof-of-Insight validators)
- Runtime infrastructure for mentor pairing and agent coordination
- Zod schemas for signal and validator metadata
- Reusable utilities for signal processing

AFI-Core is intended to evolve into the **ElizaOS-based runtime layer** that bridges AFI-Reactor's DAG orchestration with agent execution and AFI-Token's on-chain minting logic.

---

## Directory Overview

### Core Source Directories

- **`validators/`** - Signal validation modules
  - `PoIValidator.ts` - Proof-of-Insight validator (heuristic-based scoring)
  - `SignalValidator.tsx` - Base signal validator (React component, likely legacy)
  - `useSignalEvaluation.ts` - React hook for signal evaluation
  - `mock/signal.json` - Mock signal data for testing

- **`runtime/`** - Runtime infrastructure
  - `mentor_registry.ts` - MentorRegistry class for mentor pairing logic
  - Currently minimal; intended to grow into full agent runtime adapter

- **`schemas/`** - Zod schemas for type validation
  - `universal_signal_schema.mjs` - Universal signal schema
  - `validator_metadata_schema.ts` - Validator metadata schema
  - `validator_governance_schema.ts` - Governance schema
  - `signal_finalization_request_schema.ts` - Finalization request schema

- **`tests/`** - Unit tests (Vitest)
  - `mentor_registry.test.ts` - Tests for MentorRegistry
  - `poi_validator.test.ts` - Tests for PoIValidator
  - All tests currently passing (5/5)

- **`dist/`** - Compiled JavaScript output (TypeScript build artifacts)
  - Generated by `npm run build` (tsc)
  - Contains compiled versions of validators, schemas, runtime, dags, ops

### Supporting Directories

- **`afi-agents/`** - Agent persona logic (appears to be a separate module)
- **`cli_hooks/`** - CLI integration hooks
- **`signal_schema_test/`** - Signal schema testing utilities
- **`tssd_vault/`** - T.S.S.D. Vault integration (empty directory)
- **`src/`** - Additional source (appears to contain React app components)
  - `src/app/budget-decoder/` - Budget decoder app
  - `src/sections/` - UI sections (likely for demo/testing)

### Configuration & Tooling

- **`package.json`** - NPM package configuration
  - Main entry: `./dist/index.js`
  - Exports: validators, schemas
  - Scripts: build, test, simulate-signal, codex-lint, mentor-eval
  - Dependencies: zod (runtime validation)
  - DevDependencies: vitest, typescript, @types/node

- **`.afi-codex`** - AFI Codex metadata
  - Role: "runtime"
  - Entry: "runtime/mentor_registry.ts"
  - Factory ready: true

- **`README.md`** - Basic project documentation
  - Describes AFI-Core as "neural spine" of AFI Protocol
  - Lists validators, evaluation hooks, mock data, tests

---

## ElizaOS Integration Status

**Current State:** ❌ **NOT INTEGRATED**

- No imports or references to ElizaOS, Eliza, or AOS found in source code
- No agent orchestration framework detected
- No runtime adapter for ElizaOS agents
- No integration with ElizaOS tools, actions, or evaluators

**Expected Integration Points:**
- Runtime adapter to bridge Reactor DAG → ElizaOS agents
- Agent registry for ElizaOS personas and tools
- Tool/action definitions for signal processing
- Evaluator hooks for Proof-of-Intelligence checks

---

## Integration Points (Current & Expected)

### With AFI-Reactor (Expected, Not Implemented)
- **Missing:** DAG client to receive orchestration instructions from Reactor
- **Missing:** Runtime adapter to execute DAG steps using ElizaOS agents
- **Missing:** Result reporting back to Reactor after agent execution

### With AFI-Token (Expected, Not Implemented)
- **Missing:** Mint pipeline driver to generate mint instructions
- **Missing:** Integration with AFIMintCoordinator for on-chain minting
- **Missing:** Signal-to-mint transformation logic

### With T.S.S.D. Vault (Partially Implemented)
- **Present:** `tssd_vault/` directory (empty)
- **Missing:** Vault client for signal storage and retrieval
- **Missing:** Replay logic for vault signals

---

## Test Status

**Command:** `npm test` (vitest)

**Result:** ✅ **PASSING**

```
Test Files  3 passed (3)
     Tests  5 passed (5)
  Duration  270ms
```

**Test Files:**
1. `tests/mentor_registry.test.ts` - 2 tests passing
2. `tests/poi_validator.test.ts` - 1 test passing
3. `signal_schema_test/signal_schema.test.ts` - 2 tests passing

**Classification:** All tests are passing. No infrastructure or logic failures detected.

---

## Known Gaps

### Critical Gaps (Blocking ElizaOS Integration)
1. **No ElizaOS Runtime Adapter** - No bridge between Reactor DAG and ElizaOS agents
2. **No Agent Registry** - No way to register or discover ElizaOS agents/personas
3. **No DAG Client** - No way to receive orchestration instructions from Reactor
4. **No Mint Pipeline Driver** - No way to generate mint instructions for AFI-Token

### Medium Priority Gaps
5. **No Vault Client** - T.S.S.D. Vault integration is stubbed but not implemented
6. **No Replay Logic** - Cannot replay signals from vault for testing/audit
7. **Mixed Concerns** - React components (SignalValidator.tsx) mixed with runtime logic

### Low Priority Gaps
8. **No TypeScript Config** - No `tsconfig.json` found (may be using defaults)
9. **No Vitest Config** - No `vitest.config.ts` found (may be using defaults)
10. **Legacy Code** - React hooks and components suggest this was once a UI project

---

## Recommendations

### Immediate Next Steps
1. Create `runtime/afiRuntimeAdapter.ts` - Thin layer for ElizaOS integration
2. Create `runtime/mintPipelineDriver.ts` - Abstraction for mint instruction generation
3. Update `.afi-codex` to reflect ElizaOS runtime role
4. Document relationship to Reactor and Token layer

### Future Work
5. Implement ElizaOS soft fork or vendored runtime
6. Add DAG client for Reactor integration
7. Add Vault client for T.S.S.D. integration
8. Separate UI components from runtime logic
9. Add TypeScript and Vitest configuration files

---

**Last Updated:** 2025-11-16  
**Audited By:** AugmentCode

